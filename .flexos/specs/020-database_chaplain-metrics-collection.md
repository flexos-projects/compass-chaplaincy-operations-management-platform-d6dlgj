---
id: database-chaplain-metrics-collection
title: "Chaplain Metrics Collection"
description: "Complete schema, relationships, indexes, security rules, and data lifecycle for the chaplain_metrics collection (encounter records)"
type: spec
subtype: database
status: draft
sequence: 20
tags: [database, schema, chaplain-metrics, encounters, reporting]
relatesTo: [docs/core/004-database.md, docs/core/007-technical.md, specs/016-pages_reports.md]
createdAt: "2026-02-09T00:30:00Z"
updatedAt: "2026-02-09T00:30:00Z"
---

# Database: Chaplain Metrics Collection

## Overview

The `chaplain_metrics` collection stores detailed records of individual chaplain encounters with travelers, employees, and other airport community members. This is the richest dataset in COMPASS, capturing pastoral care interactions with extensive categorization for reporting to the chaplaincy board, funders, and airport administration. Each document represents a single encounter event.

## Collection Name

`chaplain_metrics`

**Document ID:** Auto-generated by Firestore (no semantic meaning)

**Estimated document count:** 1000-10,000 per year (depends on chaplain activity and encounter frequency)

## Schema

```block flex_block
type: schema
format: typescript
name: ChaplainMetric
---
interface ChaplainMetric {
  // ========================================
  // CORE ENCOUNTER DATA
  // ========================================
  chaplainId: string                       // Reference to users.uid (chaplain who logged this encounter)
  dateCollected: Timestamp                 // When the encounter occurred (event timestamp)
  dateEntered?: Timestamp                  // When the record was entered into the system (may differ from dateCollected)

  // ========================================
  // LOCATION
  // ========================================
  terminal?: string                        // Terminal letter: 'A' | 'B' | 'C' | 'D' | 'E'
  gate?: string                            // Gate identifier (e.g., "A12", "C23", "D40")
  inChapel: boolean                        // Encounter occurred in the airport chapel (vs. terminal/gate area)

  // ========================================
  // ENCOUNTER CLASSIFICATION
  // ========================================
  encounterType: {                         // Boolean flags for encounter types (multiple can be true)
    crisis: boolean                        // Crisis intervention (medical emergency, severe distress, suicide ideation)
    violence: boolean                      // Violence-related (threat, assault, domestic dispute)
    policeInvolved: boolean                // Police or security involved in the incident
    grief: boolean                         // Grief counseling (death, loss, bereavement)
    travelRelated: boolean                 // Travel-related issue (missed flight, lost luggage, delay stress)
    personalIssue: boolean                 // Personal issue (family conflict, relationship, financial)
    prayerRequested: boolean               // Prayer requested by the individual
    fallenAngel: boolean                   // "Fallen Angel" program (airport-specific term for deceased traveler handling)
  }

  // ========================================
  // ENCOUNTER MEDIUM
  // ========================================
  encounterMedium: {                       // Boolean flags for how encounter occurred (multiple can be true)
    inPerson: boolean                      // Face-to-face encounter
    byPhone: boolean                       // Phone call (chaplain called or was called)
    chatOnly: boolean                      // Chat/text-based interaction (mobile app chat)
    selfDiscovered: boolean                // Chaplain initiated contact (proactive engagement, not request-based)
  }

  // ========================================
  // ENCOUNTER DETAILS
  // ========================================
  recipientType?: string                   // Type of person helped: 'traveler' | 'employee' | 'crew' | 'vendor' | 'other'
  personsInvolved?: number                 // Number of persons involved in encounter (e.g., 2 for a couple, 5 for a family)
  isAdult: boolean                         // Encounter was with an adult (vs. minor/child)
  eventNarrative?: string                  // Detailed free-text narrative of the event (max 5000 chars)
  note?: string                            // Short notes or follow-up reminders (max 500 chars)
  images?: string[]                        // Array of image URLs from the encounter (Firebase Storage paths)
  durationMinutes?: number                 // Duration of the encounter in minutes
  timeEnded?: Timestamp                    // When the encounter ended (for duration tracking)

  // ========================================
  // TRAINING & INTERN EVALUATION
  // ========================================
  isTrainingSession: boolean               // This encounter was a training session (not a real pastoral event)
  trainingFeedback?: string                // Feedback on the training session (free text)

  internEvaluation?: {                     // Evaluation of an intern chaplain (if encounter involved intern supervision)
    name: string                           // Intern's name
    isShadowing: boolean                   // Intern was shadowing (observing)
    isAssisting: boolean                   // Intern was actively assisting
    initiative: number                     // Initiative rating (1-5 scale)
    pastoralDemeanor: number               // Pastoral demeanor rating (1-5 scale)
    pluralisticCompetence: number          // Pluralistic/interfaith competence rating (1-5 scale)
    situationalAwareness: number           // Situational awareness rating (1-5 scale)
    feedback: string                       // Free-text feedback on intern performance
  }
}
```

## Field Descriptions

### Core Encounter Data

- **chaplainId:** UID of the chaplain who logged this encounter. References `users.uid`. Required for all metrics.
- **dateCollected:** Timestamp when the encounter occurred. This is the event time, not the submission time. Chaplains may log encounters retroactively.
- **dateEntered:** Timestamp when the record was entered into the system. May differ from `dateCollected` if logged hours or days later.

### Location Fields

- **terminal:** Airport terminal where the encounter occurred. Values: 'A', 'B', 'C', 'D', 'E' (DFW-specific). Used for terminal distribution analysis.
- **gate:** Specific gate identifier (e.g., "A12", "C23"). Optional, provides finer-grained location data.
- **inChapel:** Boolean indicating if the encounter occurred in the airport chapel space (vs. terminal concourses, gates, or other areas). Chapel encounters may have different characteristics (more intentional, longer duration).

### Encounter Type Flags

All flags are boolean, multiple can be true for a single encounter. For example, an encounter could be `crisis: true, grief: true, policeInvolved: true` (crisis involving grief with police present).

- **crisis:** Crisis intervention. Includes medical emergencies, severe emotional distress, suicide ideation, panic attacks, acute trauma.
- **violence:** Violence-related encounters. Includes threats, assaults, domestic disputes, aggressive behavior, de-escalation.
- **policeInvolved:** Police or airport security were involved in the incident. Indicates higher-severity events requiring law enforcement.
- **grief:** Grief counseling. Includes bereavement, death notifications, loss, memorial services, deceased traveler situations.
- **travelRelated:** Travel-related stress or issues. Includes missed flights, lost luggage, delay frustration, travel anxiety, fear of flying.
- **personalIssue:** Personal life issues. Includes family conflict, relationship problems, financial stress, health concerns, life transitions.
- **prayerRequested:** Prayer was requested by the individual. Common in airport chaplaincy, often combined with other types.
- **fallenAngel:** "Fallen Angel" program encounters. Airport-specific term for handling deceased travelers (death in flight, death in terminal, repatriation coordination).

### Encounter Medium Flags

Multiple flags can be true. For example, `inPerson: true, prayerRequested: true` (in-person encounter where prayer was also offered).

- **inPerson:** Face-to-face encounter. The chaplain met the person physically.
- **byPhone:** Phone-based encounter. Chaplain called or received a call (from gate agent, family member, etc.).
- **chatOnly:** Chat/text-based interaction. Via mobile app chat or SMS (less common in admin dashboard context).
- **selfDiscovered:** Chaplain-initiated contact. The chaplain proactively approached the individual (vs. being called/requested). Indicates high situational awareness.

### Encounter Details

- **recipientType:** Type of person who received chaplaincy care. Values: 'traveler' (passenger), 'employee' (airport staff), 'crew' (airline crew), 'vendor' (airport vendor/contractor), 'other'.
- **personsInvolved:** Count of persons involved. Example: 2 for a couple, 4 for a family, 10 for a group prayer. Used for impact metrics.
- **isAdult:** Whether the encounter involved an adult. If false, indicates minor/child (special considerations for pastoral care with minors).
- **eventNarrative:** Detailed narrative description of the encounter. Free text, max 5000 chars. Used for case studies, training, and detailed reporting. Should be anonymized (no PII).
- **note:** Short notes or follow-up reminders. Max 500 chars. Example: "Follow up next week", "Referred to social services", "Family grateful".
- **images:** Array of Firebase Storage URLs for images related to the encounter (e.g., chapel memorial setup, signage, thank-you cards). Stored at `/encounter-images/{chaplainId}/{timestamp}.jpg`.
- **durationMinutes:** Duration of the encounter in minutes. Example: 15 for a brief prayer, 60 for an extended counseling session.
- **timeEnded:** Timestamp when the encounter ended. Used to calculate duration if not manually entered.

### Training & Intern Evaluation

- **isTrainingSession:** Boolean indicating this was a training scenario, not a real pastoral encounter. Used to filter training data from operational metrics.
- **trainingFeedback:** Free-text feedback on the training session. Example: "Good de-escalation practice", "Needs more active listening".
- **internEvaluation:** Nested object for evaluating an intern chaplain's performance during this encounter. Only populated if an intern was involved.
  - **name:** Intern's name (denormalized for display, should also reference users collection).
  - **isShadowing:** Intern was observing (not actively participating).
  - **isAssisting:** Intern was actively assisting the supervising chaplain.
  - **initiative, pastoralDemeanor, pluralisticCompetence, situationalAwareness:** 1-5 scale ratings.
  - **feedback:** Free-text feedback for the intern's learning and development.

## Relationships

### Outbound References (chaplain_metrics → other collections)

| Field | References | Collection | Cardinality |
|-------|-----------|-----------|-------------|
| chaplainId | users.uid | users | Many-to-One (many encounters by one chaplain) |

### Inbound References (other collections → chaplain_metrics)

None. This is a leaf collection (not referenced by other collections).

## Indexes

**Required composite indexes for `chaplain_metrics` collection:**

```
// Chaplain + dateCollected (for per-chaplain encounter history)
chaplain_metrics: chaplainId ASC, dateCollected DESC

// Terminal + dateEntered (for terminal-specific reporting)
chaplain_metrics: terminal ASC, dateEntered DESC

// dateCollected descending (for recent encounters on reports page)
chaplain_metrics: dateCollected DESC

// isTrainingSession + dateCollected (to filter out training data)
chaplain_metrics: isTrainingSession ASC, dateCollected DESC
```

**Index creation:**

```bash
firebase deploy --only firestore:indexes
```

## Security Rules

```javascript
// chaplain_metrics: Admins can read. Chaplains can create their own metrics.
match /chaplain_metrics/{metricId} {
  // Allow admins to read all metrics (for reporting)
  allow read: if isAdmin();

  // Allow chaplains to read their own metrics (mobile app view)
  allow read: if request.auth != null && request.auth.uid == resource.data.chaplainId;

  // Allow chaplains to create their own metrics (mobile app submission)
  allow create: if request.auth != null
    && request.resource.data.chaplainId == request.auth.uid
    && request.resource.data.dateCollected != null
    && request.resource.data.inChapel != null
    && request.resource.data.isAdult != null
    && request.resource.data.isTrainingSession != null;

  // Allow admins to update or delete any metric (corrections, data cleanup)
  allow update, delete: if isAdmin();

  // Chaplains CANNOT update their own metrics once created (immutable log)
  // Admins can edit for corrections
}

// Helper: Check admin status
function isAdmin() {
  return request.auth != null
    && get(/databases/$(database)/documents/app_settings/config).data.adminUserIds.hasAny([request.auth.uid]);
}
```

**Key rules:**
1. **Read (admin):** Admins can read all metrics for reporting and analysis.
2. **Read (chaplain):** Chaplains can read their own metrics (for personal history, mobile app).
3. **Create:** Chaplains can create metrics for themselves via mobile app. Required fields are validated.
4. **Update/Delete:** Only admins can update or delete (metrics are immutable for chaplains to ensure data integrity).

## Data Lifecycle

### Creation (Encounter Logging)

**Trigger:** Chaplain submits encounter form in mobile app

**Process:**
1. Chaplain fills out encounter form (location, type, medium, details, narrative)
2. Mobile app creates chaplain_metrics document:
   ```typescript
   {
     chaplainId: currentUser.uid,
     dateCollected: selectedDate || serverTimestamp(),
     dateEntered: serverTimestamp(),
     terminal: selectedTerminal,
     gate: gateInput || null,
     inChapel: inChapelCheckbox,
     encounterType: {
       crisis: crisisFlag,
       violence: violenceFlag,
       // ... all flags
     },
     encounterMedium: {
       inPerson: inPersonFlag,
       // ... all flags
     },
     recipientType: selectedRecipientType,
     personsInvolved: personCountInput || 1,
     isAdult: isAdultCheckbox,
     eventNarrative: narrativeText,
     note: noteText,
     images: uploadedImageUrls,
     durationMinutes: durationInput,
     isTrainingSession: false,
     internEvaluation: internData || null
   }
   ```
3. Metrics appear in admin dashboard reports page

### Update (Admin Corrections)

**Trigger:** Admin edits a metric record for data cleanup or correction

**Process:** (via admin dashboard, future feature)
1. Admin navigates to encounter detail (from reports page)
2. Admin clicks "Edit" and modifies fields
3. Server API route updates chaplain_metrics document
4. Create audit_log entry with before/after diff

### Deletion

**Use case:** Accidental submission, duplicate entry, data privacy request

**Process:**
- Admin deletes chaplain_metrics document via dashboard (future feature)
- Deletion creates audit_log entry for accountability
- Consider soft delete (deleted: true flag) instead of hard delete for audit trail

## Common Queries

### Recent encounters for dashboard

```typescript
query(collection('chaplain_metrics'),
  orderBy('dateCollected', 'desc'),
  limit(50)
)
```

### Encounters in date range (reports page)

```typescript
query(collection('chaplain_metrics'),
  where('dateCollected', '>=', fromDate),
  where('dateCollected', '<=', toDate),
  orderBy('dateCollected', 'desc')
)
```

### Terminal-filtered encounters

```typescript
query(collection('chaplain_metrics'),
  where('terminal', '==', 'A'),
  where('dateCollected', '>=', fromDate),
  where('dateCollected', '<=', toDate),
  orderBy('dateCollected', 'desc')
)
```

### Per-chaplain encounter history

```typescript
query(collection('chaplain_metrics'),
  where('chaplainId', '==', chaplainId),
  orderBy('dateCollected', 'desc'),
  limit(20)
)
```

### Crisis encounters only

```typescript
query(collection('chaplain_metrics'),
  where('encounterType.crisis', '==', true),
  where('dateCollected', '>=', fromDate),
  orderBy('dateCollected', 'desc')
)
```

## Data Quality Considerations

### Encounter Type Aggregation

- **Multiple flags:** A single encounter can have multiple type flags set to true. Reports must handle overlapping categories.
- **Example:** An encounter marked as both `crisis: true` and `grief: true` should be counted in both categories for type breakdown charts.

### PII in Narratives

- **eventNarrative field:** May contain personally identifiable information (names, flight numbers, specific details).
- **Mitigation:** Train chaplains to anonymize narratives. Admins should review narratives for PII before sharing with external stakeholders.
- **Future:** Add automatic PII detection/redaction before reports are exported.

### Intern Evaluation Completeness

- **internEvaluation object:** Should only be populated when an intern is involved. If populated, all rating fields (1-5 scale) should be present.
- **Validation:** Mobile app should enforce that if `internEvaluation` exists, all required fields are filled.

### Image Storage

- **images array:** URLs point to Firebase Storage. Storage costs grow with image volume.
- **Cleanup:** Implement periodic cleanup of orphaned images (images in Storage but not referenced by any metric).

## Open Questions

1. **Narrative privacy:** Should eventNarrative be admin-only readable, or can chaplains see each other's narratives (for training/learning)?
2. **Encounter categories:** Are the current 8 encounter types sufficient, or should we add more (e.g., "blessing", "referral", "logistics")?
3. **Duration tracking:** Should the mobile app have a built-in timer for automatic duration calculation, or rely on manual entry?
4. **Recipient anonymity:** Should there be a flag for "sensitive encounter" to hide details from reports (e.g., high-profile individual, sensitive situation)?

## Related Documents

- Core Database Doc: `docs/core/004-database.md` (Collection inventory, relationship diagram)
- Core Flows Doc: `docs/core/005-flows.md` (FL-013 Report Generation)
- Pages Spec: `specs/016-pages_reports.md` (Reports page encounter metrics section)
- Users Collection Spec: `specs/018-database_users-collection.md` (chaplainId reference)
